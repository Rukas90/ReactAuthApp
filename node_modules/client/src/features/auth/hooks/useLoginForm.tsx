import { VoidResult } from "@project/shared"
import type z from "zod"
import useAuthForm from "./useAuthForm"
import useLogin from "./useLogin"
import { LoginSchema, type LoginData } from "../schemas"

const useLoginForm = () => {
  const login = useLogin()

  const handleLogin = async (data: LoginData): Promise<VoidResult<string>> => {
    const result = await login(data)
    if (!result.ok) {
      return VoidResult.error(result.error.detail)
    }
    return VoidResult.ok()
  }

  const getValidationError = (
    form: FormData,
    validationError: z.ZodSafeParseError<LoginData>
  ): string => {
    if (!form.get("email") && !form.get("password")) {
      return "Please enter a valid email and password."
    }
    return validationError.error.issues[0].message
  }

  const form = useAuthForm({
    schema: LoginSchema,
    onAuth: handleLogin,
    getValidationError,
  })

  return {
    ...form,
  }
}
export default useLoginForm
